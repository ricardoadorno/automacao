{
  "metadata": {
    "feature": "cli-flow",
    "ticket": "P5.1",
    "env": "local"
  },
  "steps": [
    {
      "id": "cli-get-file",
      "type": "cli",
      "config": {
        "cli": {
          "command": "node",
          "args": [
            "../scripts/fetch-file.js",
            "../../sql/result.csv",
            "downloaded.csv"
          ],
          "cwd": "examples/cli-flow/work"
        }
      }
    },
    {
      "id": "cli-transform",
      "type": "cli",
      "exports": {
        "rowCount": { "source": "stdout", "jsonPath": "rows" }
      },
      "config": {
        "cli": {
          "command": "node",
          "args": [
            "../scripts/transform-file.js",
            "downloaded.csv",
            "transformed.txt"
          ],
          "cwd": "examples/cli-flow/work"
        }
      }
    },
    {
      "id": "cli-delete-pass",
      "type": "cli",
      "exports": {
        "payload": { "source": "stdout", "regex": "payload=(.*)" }
      },
      "config": {
        "cli": {
          "command": "node",
          "args": [
            "../scripts/delete-and-output.js",
            "transformed.txt"
          ],
          "cwd": "examples/cli-flow/work"
        }
      }
    },
    {
      "id": "cli-use-payload",
      "type": "cli",
      "requires": ["payload"],
      "config": {
        "cli": {
          "command": "node",
          "args": [
            "../scripts/use-payload.js",
            "{payload}"
          ],
          "cwd": "examples/cli-flow/work"
        }
      }
    }
  ],
  "failPolicy": "stop"
}
