{
  "metadata": {
    "feature": "demo-jsonplaceholder-sqlite-search",
    "ticket": "DEMO-JPS-1",
    "env": "local"
  },
  "behaviorsPath": "examples/jsonplaceholder-sqlite/behaviors.json",
  "openapiPath": "examples/jsonplaceholder/openapi.json",
  "steps": [
    {
      "id": "http-get-todo",
      "type": "swagger",
      "behaviorId": "swagger-jsonplaceholder",
      "config": {
        "operationId": "getTodoById",
        "responseSelector": "body"
      },
      "exports": {
        "todoId": {
          "source": "responseText",
          "jsonPath": "id"
        },
        "todoTitle": {
          "source": "responseText",
          "jsonPath": "title"
        },
        "todoCompleted": {
          "source": "responseText",
          "jsonPath": "completed"
        }
      }
    },
    {
      "id": "cloudwatch-echo",
      "type": "cloudwatch",
      "behaviorId": "cloudwatch-echo",
      "requires": ["todoId"],
      "config": {
        "retries": 1,
        "retryDelayMs": 500
      }
    },
    {
      "id": "cli-write-json",
      "type": "cli",
      "requires": ["todoId", "todoTitle", "todoCompleted"],
      "config": {
        "cli": {
          "command": "node",
          "args": [
            "../scripts/write-todo-json.js",
            "todo.json",
            "{todoId}",
            "{todoTitle}",
            "{todoCompleted}"
          ],
          "cwd": "examples/jsonplaceholder-sqlite/work"
        }
      }
    },
    {
      "id": "cli-read-delete",
      "type": "cli",
      "exports": {
        "payloadText": {
          "source": "stdout",
          "jsonPath": "payloadText"
        }
      },
      "config": {
        "cli": {
          "command": "node",
          "args": ["../scripts/read-delete-json.js", "todo.json"],
          "cwd": "examples/jsonplaceholder-sqlite/work"
        }
      }
    },
    {
      "id": "cli-update-sqlite",
      "type": "cli",
      "requires": ["payloadText"],
      "config": {
        "cli": {
          "command": "node",
          "args": ["../scripts/update-sqlite.js", "../jsonplaceholder.db", "{payloadText}"],
          "cwd": "examples/jsonplaceholder-sqlite/work"
        }
      }
    },
    {
      "id": "sqlite-select",
      "type": "sqlEvidence",
      "config": {
        "sql": {
          "adapter": "sqlite",
          "dbPath": "examples/jsonplaceholder-sqlite/jsonplaceholder.db",
          "query": "select id, title, completed from todos where id = {todoId}",
          "expectRows": 1
        }
      },
      "exports": {
        "todoTitleSql": {
          "source": "sql",
          "column": "title"
        }
      }
    },
    {
      "id": "search",
      "type": "browser",
      "behaviorId": "search-with-title",
      "requires": [
        "todoTitleSql"
      ]
    }
  ]
}
